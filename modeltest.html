<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeTutorBD - Online MCQ Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== BASE STYLES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hind Siliguri', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* ==================== HEADER ==================== */
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-img {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .logo-img img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .logo-text h1 {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 3px;
        }
        
        .logo-text p {
            font-size: 12px;
            color: #bdc3c7;
        }
        
        /* Search Bar */
        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #7f8c8d;
            cursor: pointer;
            font-size: 18px;
        }
        
        /* Navigation */
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        .nav-menu li a {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-menu li a:hover {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* ==================== TOP ADS ==================== */
        .top-ads {
            background: white;
            padding: 15px;
            margin: 20px auto;
            max-width: 1200px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            text-align: center;
            border: 2px dashed #ddd;
        }
        
        .ad-placeholder {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* ==================== MAIN CONTENT LAYOUT ==================== */
        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 25px;
            margin: 25px auto;
        }
        
        /* ==================== LEFT SIDEBAR ==================== */
        .sidebar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .sidebar-section {
            margin-bottom: 30px;
        }
        
        .sidebar-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-list {
            list-style: none;
        }
        
        .category-item {
            margin-bottom: 10px;
        }
        
        .category-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            text-decoration: none;
            color: #2c3e50;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .category-link:hover {
            background: #e3f2fd;
            border-left-color: #3498db;
        }
        
        .category-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .category-count {
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            min-width: 25px;
            text-align: center;
        }
        
        /* ==================== MAIN CONTENT AREA ==================== */
        .content-area {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .page-title {
            color: #2c3e50;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            font-size: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Model Tests Grid - 3-4 per row */
        .model-tests-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
        }
        
        .test-card:hover {
            border-color: #3498db;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.1);
            transform: translateY(-5px);
        }
        
        .test-header {
            margin-bottom: 15px;
        }
        
        .test-title {
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .test-category {
            background: #e3f2fd;
            color: #3498db;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            display: inline-block;
        }
        
        .test-details {
            margin-bottom: 15px;
            flex-grow: 1;
        }
        
        .test-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #eee;
        }
        
        .detail-label {
            color: #7f8c8d;
            font-size: 13px;
        }
        
        .detail-value {
            color: #2c3e50;
            font-weight: 500;
            font-size: 13px;
        }
        
        .test-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-download {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .btn-download:hover {
            background: #d5dbdb;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #27ae60, #219653);
            color: white;
        }
        
        .btn-test:hover {
            background: linear-gradient(135deg, #219653, #1e8449);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .page-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .page-btn:hover {
            background: #f8f9fa;
            border-color: #3498db;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-info {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        /* ==================== RIGHT SIDEBAR ==================== */
        .right-sidebar .sidebar-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        /* ==================== MIDDLE ADS ==================== */
        .middle-ads {
            margin: 30px 0;
            text-align: center;
        }
        
        /* ==================== FOOTER ==================== */
        .footer {
            background: #2c3e50;
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        .footer-content {
            text-align: center;
        }
        
        .copyright {
            color: #bdc3c7;
            font-size: 14px;
            margin-top: 15px;
        }
        
        /* ==================== MOBILE SIDEBAR TOGGLE ==================== */
        .mobile-sidebar-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 20px;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        /* ==================== LOADING SKELETON ==================== */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* ==================== RESPONSIVE STYLES ==================== */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 250px 1fr 250px;
            }
            
            .model-tests-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar, .right-sidebar {
                display: none;
            }
            
            .mobile-sidebar-toggle {
                display: block;
            }
            
            .model-tests-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
            }
            
            .search-container {
                order: 3;
                margin: 15px 0 0 0;
                max-width: 100%;
            }
            
            .nav-menu {
                display: none;
                width: 100%;
                flex-direction: column;
                gap: 10px;
                margin-top: 20px;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .model-tests-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .logo-text h1 {
                font-size: 20px;
            }
            
            .test-actions {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-img" id="logo-img">
                        <i class="fas fa-chalkboard-teacher" style="font-size: 28px; color: #3498db;"></i>
                    </div>
                    <div class="logo-text">
                        <h1>FreeTutorBD</h1>
                        <p>Online MCQ Learning Platform</p>
                    </div>
                </div>
                
                <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <!-- Search Bar -->
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" class="search-input" id="search-input" 
                               placeholder="টেস্ট খুঁজুন...">
                        <button class="search-btn" id="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <ul class="nav-menu" id="nav-menu">
                    <li><a href="index.html"><i class="fas fa-home"></i> হোম</a></li>
                    <li><a href="prosnobank.html"><i class="fas fa-question-circle"></i> প্রশ্নব্যাংক</a></li>
                    <li><a href="jobs.html"><i class="fas fa-briefcase"></i> চাকরি</a></li>
                    <li><a href="admin-panel.html" target="_blank"><i class="fas fa-cog"></i> এডমিন</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- ==================== TOP ADS ==================== -->
    <div class="container">
        <div class="top-ads" id="top-ads">
            <div class="ad-placeholder">
                <i class="fas fa-ad"></i> AdSense/AdStra Advertisement Area
                <div style="font-size: 12px; margin-top: 5px;">728x90</div>
            </div>
        </div>
    </div>

    <!-- ==================== MAIN CONTENT ==================== -->
    <div class="container">
        <div class="main-content">
            <!-- Left Sidebar -->
            <aside class="sidebar">
                <!-- Question Bank Categories -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-folder"></i>
                        প্রশ্নব্যাংক ক্যাটাগরি
                    </h3>
                    <ul class="category-list" id="question-categories">
                        <li class="category-item skeleton" style="height: 40px;"></li>
                        <li class="category-item skeleton" style="height: 40px;"></li>
                        <li class="category-item skeleton" style="height: 40px;"></li>
                    </ul>
                </div>

                <!-- Job Categories -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-briefcase"></i>
                        চাকরি ক্যাটাগরি
                    </h3>
                    <ul class="category-list" id="job-categories">
                        <li class="category-item skeleton" style="height: 40px;"></li>
                        <li class="category-item skeleton" style="height: 40px;"></li>
                        <li class="category-item skeleton" style="height: 40px;"></li>
                    </ul>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="content-area">
                <h2 class="page-title">
                    <i class="fas fa-file-alt"></i>
                    মডেল টেস্ট
                    <span class="page-info" id="total-tests-info">মোট ০ টেস্ট</span>
                </h2>

                <!-- Middle Ads -->
                <div class="middle-ads" id="middle-ads">
                    <div class="ad-placeholder">
                        <i class="fas fa-ad"></i> Middle Advertisement Area
                        <div style="font-size: 12px; margin-top: 5px;">728x90</div>
                    </div>
                </div>

                <!-- Model Tests Grid -->
                <div class="model-tests-grid" id="model-tests-grid">
                    <!-- Skeleton Loading -->
                    <div class="test-card skeleton" style="height: 250px;"></div>
                    <div class="test-card skeleton" style="height: 250px;"></div>
                    <div class="test-card skeleton" style="height: 250px;"></div>
                    <div class="test-card skeleton" style="height: 250px;"></div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination">
                    <!-- Pagination will be loaded here -->
                </div>
            </main>

            <!-- Right Sidebar -->
            <aside class="right-sidebar">
                <!-- Right Ads Section 1 -->
                <div class="sidebar-section" id="right-ad-1">
                    <div class="ad-placeholder" style="min-height: 250px; display: flex; flex-direction: column; justify-content: center;">
                        <i class="fas fa-ad fa-2x"></i>
                        <div style="margin-top: 10px;">Right Sidebar Ad 1</div>
                        <div style="font-size: 12px; margin-top: 5px;">300x250</div>
                    </div>
                </div>

                <!-- Right Ads Section 2 -->
                <div class="sidebar-section" id="right-ad-2">
                    <div class="ad-placeholder" style="min-height: 250px; display: flex; flex-direction: column; justify-content: center;">
                        <i class="fas fa-ad fa-2x"></i>
                        <div style="margin-top: 10px;">Right Sidebar Ad 2</div>
                        <div style="font-size: 12px; margin-top: 5px;">300x250</div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- ==================== FOOTER ==================== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2024 FreeTutorBD. All Rights Reserved.</p>
                <p class="copyright">Developed with ❤️ for Bangladeshi Students</p>
            </div>
        </div>
    </footer>

    <!-- ==================== MOBILE SIDEBAR TOGGLE ==================== -->
    <button class="mobile-sidebar-toggle" id="mobile-sidebar-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- ==================== FIREBASE SDK ==================== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- ==================== PDF LIBRARY ==================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCbfCCosPtMmkxbjp0yjBmJKo_vzzUYEiQ",
            authDomain: "freetutorbd-19380.firebaseapp.com",
            projectId: "freetutorbd-19380",
            storageBucket: "freetutorbd-19380.firebasestorage.app",
            messagingSenderId: "741837856466",
            appId: "1:741837856466:web:8b5a3b34183991e2f9570b",
            measurementId: "G-VMSB3D24F1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==================== GLOBAL VARIABLES ====================
        let allTests = [];
        let currentPage = 1;
        const testsPerPage = 15;
        let totalTests = 0;
        let totalPages = 1;
        let searchQuery = '';
        let searchTimeout = null;

        // ==================== DOM ELEMENTS ====================
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const navMenu = document.getElementById('nav-menu');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const questionCategories = document.getElementById('question-categories');
        const jobCategories = document.getElementById('job-categories');
        const modelTestsGrid = document.getElementById('model-tests-grid');
        const pagination = document.getElementById('pagination');
        const totalTestsInfo = document.getElementById('total-tests-info');

        // ==================== MOBILE MENU TOGGLE ====================
        mobileMenuToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });

        // ==================== SIDEBAR TOGGLE FOR MOBILE ====================
        document.getElementById('mobile-sidebar-toggle').addEventListener('click', () => {
            const sidebar = document.querySelector('.sidebar');
            sidebar.style.display = sidebar.style.display === 'block' ? 'none' : 'block';
        });

        // ==================== SEARCH FUNCTIONALITY ====================
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchQuery = this.value.trim().toLowerCase();
            
            searchTimeout = setTimeout(() => {
                currentPage = 1;
                loadModelTests();
            }, 500); // Debounce 500ms
        });

        searchBtn.addEventListener('click', () => {
            searchQuery = searchInput.value.trim().toLowerCase();
            currentPage = 1;
            loadModelTests();
        });

        // ==================== LOAD DATA FROM FIREBASE ====================
        function loadAllData() {
            loadQuestionCategories();
            loadJobCategories();
            loadModelTests();
        }

        // Load Question Categories (Only categories with data)
        function loadQuestionCategories() {
            db.collection('categories').get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        questionCategories.innerHTML = '<li style="text-align: center; color: #7f8c8d; padding: 20px;">কোন ক্যাটাগরি নেই</li>';
                        return;
                    }
                    
                    let html = '';
                    const categoriesWithData = [];
                    
                    // Check each category for questions
                    const categoryPromises = [];
                    
                    snapshot.forEach(doc => {
                        const cat = doc.data();
                        const promise = db.collection('questions')
                            .where('category', '==', cat.nameBn)
                            .limit(1)
                            .get()
                            .then(qSnapshot => {
                                if (!qSnapshot.empty) {
                                    categoriesWithData.push({
                                        name: cat.nameBn,
                                        count: 0 // Will update later
                                    });
                                }
                            });
                        categoryPromises.push(promise);
                    });
                    
                    Promise.all(categoryPromises).then(() => {
                        // Now get actual counts for categories with data
                        const countPromises = categoriesWithData.map(cat => {
                            return db.collection('questions')
                                .where('category', '==', cat.name)
                                .get()
                                .then(qSnapshot => {
                                    cat.count = qSnapshot.size;
                                });
                        });
                        
                        Promise.all(countPromises).then(() => {
                            if (categoriesWithData.length === 0) {
                                questionCategories.innerHTML = '<li style="text-align: center; color: #7f8c8d; padding: 20px;">কোন ক্যাটাগরি নেই</li>';
                                return;
                            }
                            
                            // Sort by count descending
                            categoriesWithData.sort((a, b) => b.count - a.count);
                            
                            // Display categories
                            categoriesWithData.forEach(cat => {
                                html += `
                                    <li class="category-item">
                                        <a href="prosnobank.html?category=${encodeURIComponent(cat.name)}" class="category-link">
                                            <span class="category-name">${cat.name}</span>
                                            <span class="category-count">${cat.count}</span>
                                        </a>
                                    </li>
                                `;
                            });
                            
                            questionCategories.innerHTML = html;
                        });
                    });
                })
                .catch(error => {
                    console.error("Error loading categories:", error);
                    questionCategories.innerHTML = '<li style="text-align: center; color: #e74c3c; padding: 20px;">লোড করতে সমস্যা হয়েছে</li>';
                });
        }

        // Load Job Categories (Only categories with data)
        function loadJobCategories() {
            db.collection('jobs').get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        jobCategories.innerHTML = '<li style="text-align: center; color: #7f8c8d; padding: 20px;">কোন চাকরি নেই</li>';
                        return;
                    }
                    
                    const categories = {};
                    
                    snapshot.forEach(doc => {
                        const job = doc.data();
                        if (categories[job.category]) {
                            categories[job.category]++;
                        } else {
                            categories[job.category] = 1;
                        }
                    });
                    
                    let html = '';
                    Object.keys(categories).forEach(catName => {
                        html += `
                            <li class="category-item">
                                <a href="jobs.html?category=${encodeURIComponent(catName)}" class="category-link">
                                    <span class="category-name">${catName}</span>
                                    <span class="category-count">${categories[catName]}</span>
                                </a>
                            </li>
                        `;
                    });
                    
                    jobCategories.innerHTML = html;
                })
                .catch(error => {
                    console.error("Error loading job categories:", error);
                    jobCategories.innerHTML = '<li style="text-align: center; color: #e74c3c; padding: 20px;">লোড করতে সমস্যা হয়েছে</li>';
                });
        }

        // Load Model Tests with Pagination
        function loadModelTests() {
            // Show skeleton loading
            modelTestsGrid.innerHTML = '';
            for (let i = 0; i < 12; i++) {
                modelTestsGrid.innerHTML += '<div class="test-card skeleton" style="height: 250px;"></div>';
            }
            
            let query = db.collection('exams')
                .where('status', '==', 'published');
            
            query.get()
                .then(snapshot => {
                    allTests = [];
                    snapshot.forEach(doc => {
                        allTests.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    // Apply search filter
                    if (searchQuery) {
                        allTests = allTests.filter(test => 
                            test.title.toLowerCase().includes(searchQuery) ||
                            test.category.toLowerCase().includes(searchQuery) ||
                            test.description.toLowerCase().includes(searchQuery)
                        );
                    }
                    
                    // Sort by creation date (newest first)
                    allTests.sort((a, b) => {
                        if (a.createdAt && b.createdAt) {
                            return b.createdAt.toDate() - a.createdAt.toDate();
                        }
                        return 0;
                    });
                    
                    totalTests = allTests.length;
                    totalPages = Math.ceil(totalTests / testsPerPage);
                    
                    // Update total tests info
                    totalTestsInfo.textContent = `মোট ${totalTests} টেস্ট`;
                    if (searchQuery) {
                        totalTestsInfo.textContent += ` (${searchQuery} এর জন্য)`;
                    }
                    
                    // Display current page
                    displayCurrentPage();
                    
                    // Update pagination
                    updatePagination();
                })
                .catch(error => {
                    console.error("Error loading exams:", error);
                    modelTestsGrid.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #e74c3c;">লোড করতে সমস্যা হয়েছে</div>';
                });
        }

        function displayCurrentPage() {
            const startIndex = (currentPage - 1) * testsPerPage;
            const endIndex = startIndex + testsPerPage;
            const currentTests = allTests.slice(startIndex, endIndex);
            
            if (currentTests.length === 0) {
                modelTestsGrid.innerHTML = `
                    <div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #7f8c8d;">
                        <i class="fas fa-search fa-3x" style="margin-bottom: 20px;"></i>
                        <h3 style="margin-bottom: 10px;">কোন টেস্ট পাওয়া যায়নি</h3>
                        <p>অনুগ্রহ করে ভিন্ন কিছু খুঁজুন</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            currentTests.forEach(test => {
                const totalMarks = test.totalQuestions * (test.marksPerQuestion || 1);
                const description = test.description || 'কোন বিবরণ নেই';
                const shortDescription = description.length > 80 ? description.substring(0, 80) + '...' : description;
                
                html += `
                    <div class="test-card">
                        <div class="test-header">
                            <h3 class="test-title" title="${test.title}">${test.title}</h3>
                            <span class="test-category">${test.category}</span>
                        </div>
                        
                        <div class="test-details">
                            <div class="test-detail">
                                <span class="detail-label">মোট মার্কস:</span>
                                <span class="detail-value">${totalMarks}</span>
                            </div>
                            <div class="test-detail">
                                <span class="detail-label">প্রশ্ন সংখ্যা:</span>
                                <span class="detail-value">${test.totalQuestions}</span>
                            </div>
                            <div class="test-detail">
                                <span class="detail-label">সময়:</span>
                                <span class="detail-value">${test.timeLimit} মিনিট</span>
                            </div>
                            <div class="test-detail">
                                <span class="detail-label">ধরণ:</span>
                                <span class="detail-value">MCQ</span>
                            </div>
                        </div>
                        
                        <div class="test-actions">
                            <button class="action-btn btn-download" onclick="downloadTestPDF('${test.id}')">
                                <i class="fas fa-download"></i> ডাউনলোড
                            </button>
                            <button class="action-btn btn-test" onclick="startTest('${test.id}')">
                                <i class="fas fa-play"></i> টেস্ট দিন
                            </button>
                        </div>
                    </div>
                `;
            });
            
            modelTestsGrid.innerHTML = html;
        }

        function updatePagination() {
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `
                <button class="page-btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            // Adjust start page if we're near the end
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // First page
            if (startPage > 1) {
                html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span class="page-info">...</span>`;
                }
            }
            
            // Page numbers
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span class="page-info">...</span>`;
                }
                html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            // Next button
            html += `
                <button class="page-btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            // Page info
            html += `
                <span class="page-info">
                    পৃষ্ঠা ${currentPage} / ${totalPages}
                </span>
            `;
            
            pagination.innerHTML = html;
        }

        function goToPage(page) {
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            displayCurrentPage();
            updatePagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==================== TEST FUNCTIONS ====================
        function startTest(examId) {
            // Redirect to examtest.html with exam ID
            window.location.href = `examtest.html?id=${examId}`;
        }

        async function downloadTestPDF(examId) {
            try {
                const doc = await db.collection('exams').doc(examId).get();
                if (!doc.exists) {
                    alert('টেস্ট পাওয়া যায়নি!');
                    return;
                }
                
                const exam = doc.data();
                
                // Get questions for this exam
                let questions = [];
                if (exam.questions && exam.questions.length > 0) {
                    questions = exam.questions;
                } else {
                    // Fetch questions from question bank
                    const qSnapshot = await db.collection('questions')
                        .where('category', '==', exam.category)
                        .limit(exam.totalQuestions)
                        .get();
                    
                    qSnapshot.forEach(qDoc => {
                        questions.push(qDoc.data());
                    });
                }
                
                // Generate PDF
                generateExamPDF(exam, questions);
                
            } catch (error) {
                console.error("Error downloading PDF:", error);
                alert('PDF ডাউনলোড করতে সমস্যা হয়েছে!');
            }
        }

        function generateExamPDF(exam, questions) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add header
            doc.setFontSize(20);
            doc.setTextColor(52, 152, 219);
            doc.text(exam.title, 105, 20, null, null, 'center');
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`ক্যাটাগরি: ${exam.category} | সময়: ${exam.timeLimit} মিনিট | প্রশ্ন: ${exam.totalQuestions} | মার্কস: ${exam.totalQuestions * (exam.marksPerQuestion || 1)}`, 105, 30, null, null, 'center');
            
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 35, 190, 35);
            
            // Add instructions
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            let yPosition = 45;
            
            doc.text('নির্দেশনা:', 20, yPosition);
            yPosition += 8;
            
            const instructions = [
                '১. সমস্ত প্রশ্নের উত্তর দিন',
                '২. প্রতিটি প্রশ্নের জন্য চারটি অপশন দেওয়া আছে',
                '৩. শুধুমাত্র একটি সঠিক উত্তর আছে',
                '৪. সময় সীমার মধ্যে উত্তর দিন'
            ];
            
            instructions.forEach(instruction => {
                doc.text(instruction, 25, yPosition);
                yPosition += 7;
            });
            
            yPosition += 10;
            
            // Add questions
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            
            questions.forEach((question, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Question text
                const questionText = `${index + 1}. ${question.question}`;
                const lines = doc.splitTextToSize(questionText, 170);
                lines.forEach(line => {
                    doc.text(line, 20, yPosition);
                    yPosition += 7;
                });
                
                // Options
                const options = [
                    `ক) ${question.option1}`,
                    `খ) ${question.option2}`,
                    `গ) ${question.option3}`,
                    `ঘ) ${question.option4}`
                ];
                
                options.forEach(option => {
                    doc.setFontSize(11);
                    doc.text(option, 25, yPosition);
                    yPosition += 7;
                });
                
                yPosition += 10;
                
                // Add page break if needed
                if (yPosition > 250 && index < questions.length - 1) {
                    doc.addPage();
                    yPosition = 20;
                }
            });
            
            // Save PDF
            doc.save(`${exam.title}_Question_Paper.pdf`);
        }

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Load all data
            loadAllData();
            
            // Set page title based on URL
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            if (category) {
                document.getElementById('page-title').innerHTML = `<i class="fas fa-folder"></i> ${category}`;
            }
        });

        // ==================== UTILITY FUNCTIONS ====================
        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = timestamp.toDate();
            return date.toLocaleDateString('bn-BD');
        }
    </script>
</body>
</html>
