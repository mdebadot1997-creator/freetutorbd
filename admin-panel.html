<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeTutorBD - Model Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Hind Siliguri', sans-serif;
        }
        
        body {
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        .header-top {
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo img {
            height: 50px;
            width: auto;
        }
        
        .logo h1 {
            font-size: 24px;
            color: #3498db;
            margin: 0;
        }
        
        .logo span {
            color: #ecf0f1;
            font-size: 14px;
        }
        
        .main-nav {
            display: flex;
            gap: 30px;
        }
        
        .nav-link {
            color: #ecf0f1;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Ads Section */
        .ads-section {
            background: white;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .ads-container {
            max-width: 728px;
            height: 90px;
            margin: 0 auto;
            background: #f8f9fa;
            border: 2px dashed #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
        }
        
        /* Main Layout */
        .main-container {
            display: flex;
            min-height: calc(100vh - 200px);
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }
        
        /* Left Sidebar - Model Test Categories */
        .left-sidebar {
            width: 280px;
            flex-shrink: 0;
        }
        
        .categories-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .categories-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .category-item:hover {
            background: #e3f2fd;
            border-color: #3498db;
            transform: translateX(5px);
        }
        
        .category-item.active {
            background: #3498db;
            color: white;
        }
        
        .category-name {
            font-weight: 500;
            font-size: 16px;
        }
        
        .category-count {
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .category-item.active .category-count {
            background: white;
            color: #3498db;
        }
        
        .show-more-btn {
            margin-top: 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            color: #3498db;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s;
        }
        
        .show-more-btn:hover {
            background: #3498db;
            color: white;
        }
        
        /* Middle Content - Model Tests */
        .middle-content {
            flex: 1;
        }
        
        .tests-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
        }
        
        .tests-title {
            color: #2c3e50;
            font-size: 24px;
            margin: 0;
        }
        
        .search-box {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        /* Model Tests Grid */
        .tests-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 1px solid #e0e0e0;
        }
        
        .test-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .test-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            line-height: 1.4;
        }
        
        .test-body {
            padding: 20px;
        }
        
        .test-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-icon {
            color: #3498db;
            font-size: 18px;
        }
        
        .info-text {
            font-size: 14px;
            color: #555;
        }
        
        .info-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .test-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-download {
            background: #27ae60;
            color: white;
        }
        
        .btn-test {
            background: #3498db;
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.05);
        }
        
        .page-btn {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .page-btn:hover:not(:disabled) {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Right Sidebar */
        .right-sidebar {
            width: 300px;
            flex-shrink: 0;
        }
        
        .ads-sidebar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            text-align: center;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7f8c8d;
        }
        
        /* Footer */
        .footer {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            text-align: center;
        }
        
        .footer-logo {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .copyright {
            color: #bdc3c7;
            font-size: 14px;
            margin-top: 20px;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .left-sidebar, .right-sidebar {
                width: 100%;
            }
            
            .tests-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .main-nav {
                gap: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .header-top {
                padding: 15px;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            .logo span {
                display: none;
            }
            
            .main-nav {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: #2c3e50;
                flex-direction: column;
                padding: 20px;
                gap: 10px;
            }
            
            .main-nav.active {
                display: flex;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .tests-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .tests-grid {
                grid-template-columns: 1fr;
            }
            
            .ads-section {
                display: none;
            }
            
            .right-sidebar {
                display: none;
            }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            text-align: center;
            padding: 50px;
            color: #3498db;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* No Results */
        .no-results {
            text-align: center;
            padding: 50px;
            background: white;
            border-radius: 10px;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="logo">
                <img src="" alt="FreeTutorBD Logo" id="site-logo">
                <div>
                    <h1>FreeTutorBD</h1>
                    <span>শিক্ষার মুক্ত দিগন্ত</span>
                </div>
            </div>
            
            <nav class="main-nav" id="main-nav">
                <a href="index.html" class="nav-link active">
                    <i class="fas fa-home"></i> হোম
                </a>
                <a href="question-bank.html" class="nav-link">
                    <i class="fas fa-question-circle"></i> প্রশ্নব্যাংক
                </a>
                <a href="quiz-test.html" class="nav-link">
                    <i class="fas fa-file-alt"></i> কুইজ টেস্ট
                </a>
                <a href="jobs.html" class="nav-link">
                    <i class="fas fa-briefcase"></i> চাকরি
                </a>
                <a href="admin-panel.html" class="nav-link">
                    <i class="fas fa-user-shield"></i> এডমিন
                </a>
            </nav>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <!-- Ads Section -->
        <div class="ads-section">
            <div class="ads-container" id="header-ad">
                <span>AdSense / Adstra Ad Here</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar - Categories -->
        <aside class="left-sidebar">
            <div class="categories-box">
                <h3 class="categories-title">
                    <i class="fas fa-folder"></i>
                    মডেল টেস্ট ক্যাটাগরি
                </h3>
                <div class="category-list" id="category-list">
                    <!-- Categories will be loaded here -->
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>ক্যাটাগরি লোড হচ্ছে...</p>
                    </div>
                </div>
                <button class="show-more-btn" id="show-more-btn">
                    <i class="fas fa-chevron-down"></i> আরও দেখুন
                </button>
            </div>
        </aside>

        <!-- Middle Content - Model Tests -->
        <main class="middle-content">
            <div class="tests-header">
                <h2 class="tests-title">টেস্ট পেপারস</h2>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-input" placeholder="টেস্ট খুঁজুন...">
                </div>
            </div>

            <div class="tests-grid" id="tests-grid">
                <!-- Model Tests will be loaded here -->
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>মডেল টেস্ট লোড হচ্ছে...</p>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination will be generated here -->
            </div>
        </main>

        <!-- Right Sidebar - Ads -->
        <aside class="right-sidebar">
            <div class="ads-sidebar">
                Sidebar Ad Here
            </div>
            <div class="ads-sidebar">
                Sidebar Ad Here
            </div>
        </aside>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">FreeTutorBD</div>
            <p>বাংলাদেশের বৃহত্তম অনলাইন শিক্ষা প্লাটফর্ম</p>
            <div class="copyright">
                © 2024 FreeTutorBD | Developed by Md Ebadot Hossen
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCbfCCosPtMmkxbjp0yjBmJKo_vzzUYEiQ",
            authDomain: "freetutorbd-19380.firebaseapp.com",
            projectId: "freetutorbd-19380",
            storageBucket: "freetutorbd-19380.firebasestorage.app",
            messagingSenderId: "741837856466",
            appId: "1:741837856466:web:8b5a3b34183991e2f9570b",
            measurementId: "G-VMSB3D24F1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==================== GLOBAL VARIABLES ====================
        let allCategories = [];
        let allTests = [];
        let filteredTests = [];
        let currentCategory = 'all';
        let currentPage = 1;
        const testsPerPage = 15;
        let showAllCategories = false;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                document.getElementById('main-nav').classList.toggle('active');
            });

            // Search functionality
            document.getElementById('search-input').addEventListener('input', function() {
                searchTests(this.value);
            });

            // Show more categories
            document.getElementById('show-more-btn').addEventListener('click', function() {
                showAllCategories = !showAllCategories;
                loadCategories();
            });

            // Load data
            loadLogo();
            loadCategories();
            loadTests();
            loadAds();
        });

        // ==================== LOGO LOADING ====================
        function loadLogo() {
            db.collection('settings').doc('logo').get()
                .then(doc => {
                    if (doc.exists) {
                        const logoUrl = doc.data().url;
                        if (logoUrl) {
                            document.getElementById('site-logo').src = logoUrl;
                        }
                    }
                });
        }

        // ==================== CATEGORIES FUNCTIONS ====================
        async function loadCategories() {
            const categoryList = document.getElementById('category-list');
            
            try {
                // Get all categories
                const categoriesSnapshot = await db.collection('categories').get();
                allCategories = [];
                
                categoriesSnapshot.forEach(doc => {
                    const category = doc.data();
                    category.id = doc.id;
                    allCategories.push(category);
                });

                // Get test counts for each category
                const testsSnapshot = await db.collection('exams').get();
                const categoryCounts = {};
                
                testsSnapshot.forEach(doc => {
                    const test = doc.data();
                    if (test.category && test.status === 'published') {
                        categoryCounts[test.category] = (categoryCounts[test.category] || 0) + 1;
                    }
                });

                // Update category counts
                allCategories.forEach(cat => {
                    cat.testCount = categoryCounts[cat.nameBn] || 0;
                });

                // Filter categories with tests (minimum 1 test)
                const categoriesWithTests = allCategories.filter(cat => cat.testCount > 0);

                // Sort by test count (descending)
                categoriesWithTests.sort((a, b) => b.testCount - a.testCount);

                // Display categories
                let categoriesToShow = showAllCategories ? 
                    categoriesWithTests : 
                    categoriesWithTests.slice(0, 5);

                if (categoriesWithTests.length === 0) {
                    categoryList.innerHTML = `
                        <div class="no-results">
                            <p>কোন ক্যাটাগরি পাওয়া যায়নি</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                categoriesToShow.forEach((category, index) => {
                    html += `
                        <div class="category-item ${currentCategory === category.nameBn ? 'active' : ''}" 
                             onclick="filterByCategory('${category.nameBn}')">
                            <span class="category-name">${category.nameBn}</span>
                            <span class="category-count">${category.testCount}</span>
                        </div>
                    `;
                });

                categoryList.innerHTML = html;

                // Update show more button text
                const showMoreBtn = document.getElementById('show-more-btn');
                if (categoriesWithTests.length <= 5) {
                    showMoreBtn.style.display = 'none';
                } else {
                    showMoreBtn.style.display = 'block';
                    showMoreBtn.innerHTML = showAllCategories ? 
                        '<i class="fas fa-chevron-up"></i> কম দেখুন' : 
                        '<i class="fas fa-chevron-down"></i> আরও দেখুন';
                }

            } catch (error) {
                console.error('Error loading categories:', error);
                categoryList.innerHTML = `
                    <div class="no-results">
                        <p>ক্যাটাগরি লোড করতে সমস্যা হয়েছে</p>
                    </div>
                `;
            }
        }

        function filterByCategory(category) {
            currentCategory = category;
            currentPage = 1;
            loadCategories(); // Update active category
            searchTests(document.getElementById('search-input').value);
        }

        // ==================== TESTS FUNCTIONS ====================
        async function loadTests() {
            const testsGrid = document.getElementById('tests-grid');
            
            try {
                const snapshot = await db.collection('exams')
                    .where('status', '==', 'published')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                allTests = [];
                snapshot.forEach(doc => {
                    const test = doc.data();
                    test.id = doc.id;
                    allTests.push(test);
                });

                filteredTests = [...allTests];
                displayTests();
                setupPagination();

            } catch (error) {
                console.error('Error loading tests:', error);
                testsGrid.innerHTML = `
                    <div class="no-results">
                        <p>টেস্ট লোড করতে সমস্যা হয়েছে</p>
                    </div>
                `;
            }
        }

        function searchTests(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            currentPage = 1;
            
            if (!term && currentCategory === 'all') {
                filteredTests = [...allTests];
            } else {
                filteredTests = allTests.filter(test => {
                    const matchesSearch = !term || 
                        test.title.toLowerCase().includes(term) ||
                        test.category.toLowerCase().includes(term) ||
                        (test.description && test.description.toLowerCase().includes(term));
                    
                    const matchesCategory = currentCategory === 'all' || test.category === currentCategory;
                    
                    return matchesSearch && matchesCategory;
                });
            }
            
            displayTests();
            setupPagination();
        }

        function displayTests() {
            const testsGrid = document.getElementById('tests-grid');
            
            if (filteredTests.length === 0) {
                testsGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search fa-3x" style="color: #7f8c8d; margin-bottom: 20px;"></i>
                        <h3>কোন টেস্ট পাওয়া যায়নি</h3>
                        <p>অনুগ্রহ করে অন্য কিওয়ার্ড দিয়ে খুঁজুন</p>
                    </div>
                `;
                return;
            }

            // Calculate start and end index for current page
            const startIndex = (currentPage - 1) * testsPerPage;
            const endIndex = startIndex + testsPerPage;
            const testsToShow = filteredTests.slice(startIndex, endIndex);

            let html = '';
            testsToShow.forEach(test => {
                html += `
                    <div class="test-card">
                        <div class="test-header">
                            <h3 class="test-title">${test.title}</h3>
                        </div>
                        <div class="test-body">
                            <div class="test-info-grid">
                                <div class="info-item">
                                    <i class="fas fa-star info-icon"></i>
                                    <div class="info-text">
                                        <div>মোট মার্কস</div>
                                        <div class="info-value">${test.totalMarks || test.marksPerQuestion * test.totalQuestions}</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-question-circle info-icon"></i>
                                    <div class="info-text">
                                        <div>প্রশ্ন সংখ্যা</div>
                                        <div class="info-value">${test.totalQuestions}</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-clock info-icon"></i>
                                    <div class="info-text">
                                        <div>সময়</div>
                                        <div class="info-value">${test.timeLimit} মিনিট</div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-folder info-icon"></i>
                                    <div class="info-text">
                                        <div>ক্যাটাগরি</div>
                                        <div class="info-value">${test.category}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="test-actions">
                                <button class="action-btn btn-download" onclick="downloadTestPDF('${test.id}')">
                                    <i class="fas fa-download"></i> ডাউনলোড
                                </button>
                                <button class="action-btn btn-test" onclick="startTest('${test.id}')">
                                    <i class="fas fa-play-circle"></i> টেস্ট দিন
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });

            testsGrid.innerHTML = html;
        }

        function setupPagination() {
            const paginationDiv = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredTests.length / testsPerPage);
            
            if (totalPages <= 1) {
                paginationDiv.style.display = 'none';
                return;
            }
            
            paginationDiv.style.display = 'flex';
            
            let html = '';
            
            // Previous button
            html += `
                <button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i> পূর্ববর্তী
                </button>
            `;
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            // Next button
            html += `
                <button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    পরবর্তী <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationDiv.innerHTML = html;
        }

        function changePage(page) {
            if (page < 1 || page > Math.ceil(filteredTests.length / testsPerPage)) return;
            currentPage = page;
            displayTests();
            setupPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==================== TEST ACTIONS ====================
        function startTest(testId) {
            // Store test ID in localStorage for test page
            localStorage.setItem('currentTestId', testId);
            // Redirect to test page
            window.location.href = `test-exam.html?id=${testId}`;
        }

        async function downloadTestPDF(testId) {
            try {
                // Get test data
                const docRef = await db.collection('exams').doc(testId).get();
                const test = docRef.data();
                
                // Get questions for this test
                const questionsSnapshot = await db.collection('questions')
                    .where('category', '==', test.category)
                    .limit(test.totalQuestions || 50)
                    .get();
                
                const questions = [];
                questionsSnapshot.forEach(qDoc => {
                    questions.push(qDoc.data());
                });
                
                // Generate PDF
                generatePDF(test, questions);
                
            } catch (error) {
                console.error('Error downloading test:', error);
                alert('PDF ডাউনলোড করতে সমস্যা হয়েছে');
            }
        }

        function generatePDF(test, questions) {
            // Create a simple text-based PDF content
            let pdfContent = `
                Test Name: ${test.title}
                Full Marks: ${test.totalMarks || 'N/A'}
                Total Questions: ${test.totalQuestions}
                Time: ${test.timeLimit} minutes
                Category: ${test.category}
                
                ============================================
                
                QUESTIONS:
                
            `;
            
            // Add questions
            questions.forEach((q, index) => {
                pdfContent += `
                ${index + 1}. ${q.question}
                   A. ${q.option1}
                   B. ${q.option2}
                   C. ${q.option3}
                   D. ${q.option4}
                   Answer: ${['A', 'B', 'C', 'D'][q.correctAnswer - 1]}
                   
                `;
            });
            
            // Add footer
            pdfContent += `
                ============================================
                
                carrybee.com | Developed by Md Ebadot Hossen
            `;
            
            // Create downloadable text file (simple version)
            const blob = new Blob([pdfContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${test.title.replace(/\s+/g, '_')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert('টেস্ট ডাউনলোড শুরু হয়েছে!');
        }

        // ==================== ADS LOADING ====================
        function loadAds() {
            // Load header ad
            db.collection('ads').doc('header').get()
                .then(doc => {
                    if (doc.exists && doc.data().code) {
                        document.getElementById('header-ad').innerHTML = doc.data().code;
                    }
                });
            
            // Load sidebar ads
            db.collection('ads').doc('sidebar').get()
                .then(doc => {
                    if (doc.exists && doc.data().code) {
                        document.querySelectorAll('.ads-sidebar').forEach(ad => {
                            ad.innerHTML = doc.data().code;
                        });
                    }
                });
        }

        // ==================== REAL-TIME UPDATES ====================
        // Listen for real-time updates on tests
        db.collection('exams')
            .where('status', '==', 'published')
            .onSnapshot((snapshot) => {
                // Reload tests when there are changes
                loadTests();
            });

        // Listen for real-time updates on categories
        db.collection('categories').onSnapshot((snapshot) => {
            // Reload categories when there are changes
            loadCategories();
        });

    </script>
</body>
</html>
